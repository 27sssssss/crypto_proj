<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.cdnfonts.com/css/century-gothic-paneuropean" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
body {
    background-image: url('files123/page2.png');
    margin: 0;
    padding: 0;
    display: flex;
    background-size: cover;
    background-repeat: no-repeat;
}

@font-face {
        font-family: 'Century Gothic Paneuropean';
        src: url(../files123/CENTURYGOTHIC.TTF);
        font-weight: 100
}

@font-face {
        font-family: 'Century Gothic Paneuropean';
        src: url(../files123/CENTURYGOTHIC_BOLD.TTF);
        font-weight: 800;
}
.header-wrapper {
    margin-left: 40px;
}

.settings{
    font-size: 20px;
    font-weight: 100;
    color: #2CBD77;
}

.greenrec{
    width: 88px;
    height: 5px; 
    left: 0px; 
    top: 0px; 
    position: absolute; 
    background: #2CBD77;
    border-top-left-radius: 6px; 
    border-top-right-radius: 6px;
}
#TableData{
    width: 1000px;
    height: 600px;
    overflow-y: scroll; 
}

th {
    padding: 13px 5px;
    padding-top: 15px;
    padding-bottom:15px;
    padding-left: 40px;
    padding-right: 20px;
    font-size: 20px;
    font-family: Century Gothic Paneuropean;
    font-weight: 800;
    color: #D1D1D1;
    text-align: left;
}

table {
    background-color: #131313be;
    margin-left: 50px;
    border-radius: 51px; 
    border-collapse: collapse;
    margin-bottom:30px;
}


thead {
    opacity: 1;
    height: 40px;
    background-color: #2e2e2e;
    border-top-left-radius: 51px;
    border-top-right-radius: 51px;
}

thead th:first-child {
    opacity: 1;
    border-top-left-radius: 51px; 
}

thead th:last-child {
    opacity: 1;
    border-top-right-radius: 51px; 
}
td {
    padding-top: 20px;
    padding-bottom: 0px;
    padding-left: 40px;
    padding-right: 30px;
    font-size: 20px;
    font-family: Century Gothic Paneuropean;
    font-weight: 800;
    color: rgb(242, 240, 240);
    text-align: center;
}


h1 {
    text-align: center;
    font-size: 25px;
    font-family: Century Gothic Paneuropean;
    font-weight: 700;
    color: white;
}

.timebutton{
    text-align: left;
    margin-left: 140px ;
    background: #2E2E2E;
    border-radius: 35px;
    height: 67px;
    width: 430px;
    color: rgba(255, 255, 255, 0.80); 
    font-size: 20px; 
    font-family: Century Gothic Paneuropean; 
    font-weight: 700;
}
.timebutton2{
    background: #202020;
    height: 67px;
    width: 380px;
    color: rgba(254, 254, 254, 0.8);
    font-family: Century Gothic Paneuropean;
    font-size: 20px; 
    margin-left: 510px;
    border-radius: 35px;
    margin-top: -88px;
    font-weight: 800px;
    align-items: center;
}
.totaldata {
    display: inline-flex;
    gap: 10px;
    margin-bottom: 10px;
    padding: 10px 10px 10px 14px;
}

.totaldata div {
    margin: 5px;
    width: 230px;
    max-height: 40px;
    display: inline-flex;
    background-color: #2E2E2E;
    color: white;
    border-radius: 35px;
    text-align: center;
    font-size: 14px;
    padding: 10px;
    position: relative;
    align-items: center;
}
.container {
    max-width: 950px;
    margin: 0 auto; 
    margin-top: 30px;
    max-height: 120vh;
}

.ltc {
    font-weight: 50;
    font-family: Century Gothic Paneuropean;
}

.card {
    background-color: #202020;
    color: white;
    margin: 11px;
    width: 88px;
    height: 88px;
    border-radius: 15px;
    border: 1px solid #202020;
    text-align: left;
}
.card-wrapper {
    margin-top: -20px;
    gap: 0px;
    margin-left: 0px;
    align-items: center;
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
}
#TableData::-webkit-scrollbar {
    opacity: 0;
    width: 1px;
}

#TableData::-webkit-scrollbar-thumb {
    background: #88888800;
    border-radius: 6px;
}

#TableData::-webkit-scrollbar-track {
    background: #f1f1f100; 
    border-radius: 6px;
}


#TableData::-webkit-scrollbar-thumb:hover {
    background: #55555500;
}


.card p {
    margin: 5px 0;
    font-size: 10px;
}

.card h2 {
    font-size: 16px;
    margin-top: 0px;
    text-align: center;
    margin-right: 10px;
}
.cardheader{
    color: white; 
    font-size: 16px; 
    font-family: Century Gothic Paneuropean; 
    font-weight: 700; 
}
.cardghz{
    opacity: 0.80;
    color: #D1D1D1;
    font-size: 10px;
    font-family: Century Gothic Paneuropean;
    font-weight: 50;
}
.celcius{
    padding-left: 10px;
}

.greenline{
    width: 86px;
    height: 4px; 
    background: #2CBD77; 
    border-top-left-radius: 15px; 
    border-top-right-radius: 15px;
    margin-top: 1px;
    margin-bottom: 5px;
}
.whiteline{
    margin-top: -12px;
    margin-left: 9px;
    width: 67px;
    height: 0px; 
    border: 0.5px white solid
}
@media only screen and (max-width: 768px) {
    body {
        zoom: 0.5;
        transform-origin: top;
        height: 1000px;
    }
    .container {
        padding-left: 0;
        padding-right: 0;
    }
}


</style>
<body>
    <div class="container">
    <div id= "totaldata">
        <div style="width: 250px;" id="ghs">
            <img style= "margin-left: 7px;  width: 40px;" src="files123/weather.png" alt="">
            <div id="ghscount" style="text-align: center; margin-top: 10px; color: white; font-size: 31px; font-family: Century Gothic Paneuropean; font-weight: 700;
            "></div>
            <div>
                <p style="text-decoration: underline; margin-top: 2px; margin-left: -13px;text-align: center; color: #D1D1D1; font-size: 20px; font-family: Century Gothic Paneuropean; font-weight: 50;">
                    °С
                </p>
                <p style="margin-bottom:-10px;  margin-left: -26px; color: #D1D1D1; font-size: 10px; font-family: Century Gothic Paneuropean; font-weight: 400;">
                    %hum
                </p>
            </div>
        </div>
        <div style="width: 180px;" id="wat">
            <img style="margin-left: 3px; margin-top: 1px; width: 28px" src="files123/plug.png" alt="">
            <div id="watcount" style="font-weight: 800; margin-left: -3px;text-align: center; color: white; font-size: 31px; font-family: Century Gothic Paneuropean; font-weight: 800"></div>
            <div>
                <p style="margin-left: -10px; margin-top:1px; text-decoration: underline; text-align: left; color: #D1D1D1; font-size: 15px; font-family: Century Gothic Paneuropean; font-weight: lighter;">
                    KW
                </p>
                <p style=" margin-bottom: -6px; margin-left: -26px; color: white; font-size: 8px; font-family: Century Gothic Paneuropean; font-weight: 400;">
                    POWER
                </p>
            </div>
        </div>
        <div style="width: 190px;" id="usd">
            <img style=" margin-bottom: -3px ;margin-left: 9px; width: 25px; margin-top: -5px;" src="files123/wallet.png" alt="">
            <div style="text-align: center; color: white; font-size: 28px; font-family: Century Gothic Paneuropean; font-weight: 800" id="usdcount"></div>
            <div>
                <p style="margin-left: -10px;  margin-top:3px; text-decoration: underline; text-align: center; color: #D1D1D1; font-size: 15px; font-family: Century Gothic Paneuropean; font-weight: 400;">
                    USD
                </p>
                <p style="margin-bottom:0.5px;  margin-left: -28px; color:#D1D1D1; font-size: 12px; font-family: Century Gothic Paneuropean; font-weight: 400;">
                    день
                </p>
            </div>
        </div>
        <div style="width: 180px" id="devices">
            <img style="margin-left:10px; width: 25px; color: white;" src="files123/pickaxe.png" alt="">
            <div style="text-align: center; color: white; font-size: 31px; font-family: Century Gothic Paneuropean; font-weight: 800" id="devicescount"></div>
            <div>
                <p style="margin-left: -20px; color: #D1D1D1; font-size: 15px; font-family: Century Gothic Paneuropean; font-weight: 400;">
                    MINING
                </p>
            </div>
        </div>
    </div>
    <div id = "TableData"></div>
    <div class="timebutton">
        <p style="padding-top: 24px; padding-left: 40px;" >Последнее время обновления:</p>
    </div>
    <div style="margin-top: -67px" class="timebutton2">
        <img style= "margin-bottom: -36px; margin-left: 20px;  width: 40px;" src="files123/clock.png" alt="">
        <p id="timep" style="font-size: 25px; text-align: center; margin-top: -1px"></p>
    </div>
    <a style="font-size: 20px; color: #D1D1D1; font-family: Century Gothic Paneuropean; padding-left: 50vh; margin-top: 30px; display: block;" href="additionalData.html">Дополнительные данные</a>
</div>


    <script>
        setInterval(getTime,1000);
        setInterval(showalldata(),50000);
        setInterval(fulltable(),50000); 
        async function showalldata(){
        try{
        const reply = await fetch('https://api.minerstat.com/v2/stats/23m9xdi3g1xz');
        const data = await reply.json();
        const showData = document.getElementById("totaldata");
        showData.classList.add("totaldata");
        let totalHrate = 0;
        let totalPower = 0;
        let totalUsd = 0;
        let totalCount = 0;
        let workingCount = 0;
        for (let deviceName in data){
            totalCount += 1;
            const deviceData = data[deviceName];
            let Hrate = deviceData.mining && deviceData.mining.hashrate ? deviceData.mining.hashrate.hashrate : 0;
            let HrateUnit = deviceData.mining && deviceData.mining.hashrate ? deviceData.mining.hashrate.hashrate_unit : 0;
            if (HrateUnit === 'MH'){
                Hrate = Hrate/1000;
            }
            let Power = deviceData.hardware ? deviceData.hardware.reduce((total = 0, hardware) => {return total + (hardware.power || 0);}, 0): 0;
            let Usd  = deviceData.revenue ? deviceData.revenue.usd_day : 0;
            totalHrate += Hrate;
            totalPower += Power;
            totalUsd += Usd;
            if (Usd !== 0 && Hrate !== 0 && Power !== 0){
                workingCount += 1;
            }
        }
        document.getElementById("watcount").textContent = `${totalPower}`;
        document.getElementById("usdcount").textContent = `${totalUsd.toFixed(2)}`;
        document.getElementById("devicescount").textContent = `${workingCount}/${totalCount}`;
    }
    catch (error) {
        console.error('Ошибка вывода данных', error);
    }
}
        async function fulltable(){
            try {
            const reply = await fetch('https://api.minerstat.com/v2/stats/23m9xdi3g1xz');
            const data = await reply.json();
            const tableData = document.getElementById('TableData');
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const headRow = document.createElement('tr');
            headRow.innerHTML = `
            <th>Воркер</div></th>
            <th>Майнинг</div></th>
            <th>Макс Темп</div></th>
            <th>Макс Вент</div></th>
            <th>Мощность</div></th>
            `;
            thead.appendChild(headRow);
            table.appendChild(thead);
            const tableBody = document.createElement('tbody');
            for (let deviceName in data) {
            const deviceData = data[deviceName];
            let HrateUnit = deviceData.mining && deviceData.mining.hashrate ? deviceData.mining.hashrate.hashrate_unit : 0;
            let mintemp = minTemp(deviceData.hardware);
            let maxtemp = maxTemp(deviceData.hardware);
            let maxvent = maxVent(deviceData.hardware);
            let Hrate = deviceData.mining && deviceData.mining.hashrate ? deviceData.mining.hashrate.hashrate : 0;
            const deviceRow = document.createElement('tr');
            deviceRow.innerHTML = `
                <td style="">${deviceName}</td>
                <td>${Hrate.toFixed(1)}<span class="settings"> ${HrateUnit}/z</span></td>
                <td>${mintemp} °C - ${maxtemp} °C</td>
                <td>${maxvent} <span class="settings">RPM</span></td>
                <td>${totalPower(deviceData)} <span class="settings"> W</span></td>`;
            tableBody.appendChild(deviceRow);
            if (deviceData.hardware) {
        const cardWrapper = document.createElement('div');
        cardWrapper.classList.add('card-wrapper');
        for (let antminer of deviceData.hardware) {
            const card = makeCard(antminer, HrateUnit);
            cardWrapper.appendChild(card);
        }
        const cardRow = document.createElement('tr');
        const cardCell = document.createElement('td');
        cardCell.colSpan = 5;
        cardCell.appendChild(cardWrapper);
        cardRow.appendChild(cardCell);
        tableBody.appendChild(cardRow);
    }
        }

        table.appendChild(tableBody);
        tableData.innerHTML = '';
        tableData.appendChild(table);
    } catch (error) {
        console.error('Ошибка вывода таблицы', error);
    }
}

        function minTemp(data){
            let minTemp = 0;
            for (hardwareName in data){
                hardwareData = data[hardwareName];
                if (hardwareData.temp !== undefined && hardwareData.temp > minTemp){
                    minTemp = hardwareData.temp;
                }
            }
            return minTemp;
        }
        function maxTemp(data){
            let maxTemp = 0;
            for (hardwareName in data){
                hardwareData = data[hardwareName];
                if (hardwareData.temp2 !== undefined && hardwareData.temp2 > maxTemp){
                    maxTemp = hardwareData.temp2;
                }
            }
            return maxTemp;
        }
        function maxVent(data){
            let maxVent = 0;
            for (hardwareName in data){
                hardwareData = data[hardwareName];
                if (hardwareData.fan !== undefined && hardwareData.fan > maxVent){
                    maxVent = hardwareData.fan;
                }
            }
            return maxVent;
        }
        function totalPower(deviceData){
            return deviceData.hardware ? deviceData.hardware.reduce((total, hardware) => {
            return total + (hardware.power || 0);
        }, 0)
        : 0;
        }
    function makeCard(data, HrateUnit){
        let card = document.createElement("div");
        card.classList.add("card");
        let greenchop = document.createElement("div");
        greenchop.classList.add("greenline");
        card.appendChild(greenchop);
        let title = document.createElement("h2");
        title.classList.add("card-title");
        card.appendChild(title);
        let speedUnit = document.createElement("span");
        speedUnit.textContent = ` ${HrateUnit}/z`;
        speedUnit.classList.add("cardghz");
        if (data.speed !== undefined) {
            let speedValue = document.createElement("span");
            speedValue.textContent = data.speed.toFixed(0);
            title.appendChild(speedValue);
            title.appendChild(speedUnit);
        } else {
            title.textContent = ' - ';
            title.appendChild(speedUnit);
        }

        let whiteline = document.createElement("div");
        whiteline.classList.add("whiteline");
        card.appendChild(whiteline);
        let temperature = document.createElement("p");
        temperature.classList.add("celcius");
        temperature.innerHTML = 
        data.temp !== undefined && data.temp2 !== undefined
            ? `${data.temp} <span class="cardghz">°C</span> - ${data.temp2} <span class="cardghz">°C</span>`
            : data.temp !== undefined
            ? `${data.temp} <span class="cardghz">°C</span> - -`
            : data.temp2 !== undefined
            ? `- - ${data.temp2} <span class="cardghz">°C</span>`
            : '-<span class="cardghz">°C</span> -<span class="cardghz">°C</span>';
        card.appendChild(temperature);
        let rpm = document.createElement("p");
        rpm.classList.add("celcius");
        rpm.innerHTML = data.fan !== undefined ? `${data.fan} <span class="cardghz">RPM</span>` : '-';
        card.appendChild(rpm);
        let wat = document.createElement("p");
        wat.classList.add("celcius");
        wat.innerHTML = data.power !== undefined ? `${data.power} <span class="cardghz">W</span>` : '-';
        card.appendChild(wat);
        return card;
    }
    async function getTime() {
    try {
        const reply = await fetch('https://api.minerstat.com/v2/stats/23m9xdi3g1xz');
        const data = await reply.json();
        const timeBlock = document.getElementById('timep');
        if (timeBlock){
            for (const key in data){
                if (data[key].info.status == "online"){
                    timeBlock.textContent = (data[key].info.time);
                    return 0;
                }
            }
            timeBlock.textContent = 'Все устройства отключены';
        } 
    } 
    catch (error){
        console.error('Ошибка', error);
    }
}
    async function getWeather(){
        const token = '7641094710b56cc3afcb9af0d49b7a25';
        const apiData = 'https://api.openweathermap.org/data/2.5/weather?units=metric&q=pavlovsk&appid=7641094710b56cc3afcb9af0d49b7a25'
        const response = await fetch(apiData);
        const data = await response.json();
        console.log(data, "data");
        const temperature = data.main.temp;
        const humidity = data.main.humidity;
        console.log(temperature);
        console.log(humidity);
        document.getElementById("ghscount").textContent = `${temperature}/${humidity}`;
    }
    getWeather();
    </script>
</body>
</html>